{
  "hash": "2b0fcb9427968ce5775cc56773d72e31",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Midterm Assignment\"\nauthor: \"Barrie Robison\"\ndate: \"2024-03-07\"\ncategories: [Assignment, DataViz, Tables, Project]\nimage: \"Cthulhuhockeycard.png\"\ncode-fold: true\ncode-tools: true\ndescription: \"Are we good at grants and stuff?\"\n---\n\n\n## OVERVIEW\n\nThis assignment provides you the opportunity to synthesize all of the concepts we've covered in the course to date. The basic framework is that you will create a COMPLETE data visualization BLOG post that is suitable as a showcase component of your Data Science Portfolio. The point is to [SHOW]{.red} people your skills.\n\n## STRUCTURE\n\nThe basic formatting guidelines for this assignment are:\n\n1.  Include `code fold` or `code tools` options (or both) that allow users to view and copy your code while maintaining overall readability of your post.\n2.  Suppress all output and warnings that might distract from your visualizations and writing.\n3.  Properly title your assignment. The main title should be **\"BCB 520 - Midterm Portfolio Post\"**, and the subtitle should be a descriptive title related to the topic.\n4.  Include author, date, categories, and a description in your YAML header.\n5.  Write clear, complete sentences for a target audience with some scientific background but little training in formal data science.  Imagine your report is intended for high level University leadership (presidents and vice presidents) and the State Board of Education.\n6.  Use the header hierarchy and create a sensible document outline with white space. Format for readability! Use **bold** and *italic* fonts to emphasize things! Use [color]{.red} by customizing your `.css` file!\n\n**In addition to the above formatting guidelines, your portfolio post must contain the following sections:**\n\n### Preamble\n\nWrite a brief paragraph describing the primary questions or purpose of the post. Use clear, concise language to justify the post to a naive reader.  Why is the question or purpose important?\n\n### Data\n\nWrite a summary of the data sources you have used. Include a `Data Dictionary` table that fully describes each individual data source used. You may supplement the data supplied to you with additional sources if you like, but this is not required. \n\n### Visualizations\n\nCreate your visualizations in response to the questions and prompts. Answer the questions and prompts directly. Draw a conclusion or inference related to each. Identify limitations and the types of data you would need to mitigate those limitations. Also include text that explains any steps or design choices you considered while exploring the vizualization options [this normally wouldn't appear in the report to the vice president, but I'd like a window into your process]. Be sure to include clearly labeled axes and a concise but complete figure caption for each visualization. Make deliberate choices for color palettes, point marks, line types, etc. Demonstrate that you understand the concepts we have covered!\n\n### Conclusions or Summary\n\nSummarize your results. What new questions have emerged as a result of your visualizations? What interesting next steps have emerged?\n\n## RUBRIC\n\nI will evaluate the following for your portfolio post:\n\n**1. Clarity of writing (15%):** Complete, clear sentences. Good Grammar. Understandable to target audience. Logical flow of ideas.\n\n**2. Adherence to format (15%):** Did you follow directions?\n\n**3. Viz Execution (40%):** Are the visualizations effective? Do they adhere to the principles of effectiveness? Are choices for idiom, marks, channels, etc made deliberately and well justified?\n\n**5. Creativity (30%):** Did you push your boundaries and learn new techniques? Is the overall post compelling and interesting? Are the visualizations inspiring, creative, unique, and generally impressive? If I were recruiting a new data scientist (and I often am), would this portfolio post impress me, or would it damage your candidacy during review?\n\n# TASK\n\nI am assigning you a real task that has multiple paths to a high quality response.  It is related to one of the projects within IIDS, in which we are helping the UI Office of Research and Economic Development leverage institutional data for strategic decisions.\n\nIn this case, we'll work with award (grant) data from four federal sponsors:\n\n1. The National Science Foundation\n2. The National Institutes of Health\n3. The Department of Energy\n4. The US Department of Agriculture\n\n## THE DATA\n\n\n### Department of Agriculture (NIFA)\n\nTheir award database is [here](https://portal.nifa.usda.gov/lmd4/recent_awards), and I've downloaded the awards to the University of Idaho and put the file (USDAtoUI) in the post directory.\n\n### Department of Energy\n\nI've downloaded their whole award data set from [here](https://pamspublic.science.energy.gov/WebPAMSExternal/Interface/Awards/AwardSearchExternal.aspx?controlName=ContentTabs) and put the file (DOEawards.xlsx) in the github directory for this post.\n\n### National Institutes of Health\n\nWe can grab data from the NIH API, which is well described [here](https://api.reporter.nih.gov/documents/Data%20Elements%20for%20RePORTER%20Project%20API_V2.pdf).\n\n\n### National Science Foundation\n\nThe NSF also has an API, and the following code will pull down awards to the University of Idaho into a data frame called `NSFtoUI`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(httr)\nlibrary(jsonlite)\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.4.4     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.0\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter()  masks stats::filter()\n✖ purrr::flatten() masks jsonlite::flatten()\n✖ dplyr::lag()     masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(readxl)\n\n\n# Base URL for the API\nbase_url <- \"https://www.research.gov/awardapi-service/v1/awards.json?awardeeName=%22regents+of+the+university+of+idaho%22\"\n\nprintFields <- \"rpp,offset,id,agency,awardeeCity,awardeeCountryCode,awardeeDistrictCode,awardeeName,awardeeStateCode,awardeeZipCode,cfdaNumber,coPDPI,date,startDate,expDate,estimatedTotalAmt,fundsObligatedAmt,ueiNumber,fundProgramName,parentUeiNumber,pdPIName,perfCity,perfCountryCode,perfDistrictCode,perfLocation,perfStateCode,perfZipCode,poName,primaryProgram,transType,title,awardee,poPhone,poEmail,awardeeAddress,perfAddress,publicationResearch,publicationConference,fundAgencyCode,awardAgencyCode,projectOutComesReport,abstractText,piFirstName,piMiddeInitial,piLastName,piEmail\"\n\n# Initialize an empty data frame to store results\nNSFtoUI <- tibble()\n\n# Number of results per page (as per API settings)\nresults_per_page <- 25\n\n# Variable to keep track of the current page number\ncurrent_page <- 1\n\n# Variable to control the loop\nkeep_going <- TRUE\n\nwhile(keep_going) {\n    # Calculate the offset for the current page\n    offset <- (current_page - 1) * results_per_page + 1\n\n    # Construct the full URL with offset\n    url <- paste0(base_url, \"&offset=\", offset, \"&printFields=\", printFields)\n\n    # Make the API call\n    response <- GET(url)\n\n    # Check if the call was successful\n    if (status_code(response) == 200) {\n        # Extract and parse the JSON data\n        json_data <- content(response, type = \"text\", encoding = \"UTF-8\")\n        parsed_data <- fromJSON(json_data, flatten = TRUE)\n\n        # Extract the 'award' data and add to the all_awards data frame\n        awards_data <- parsed_data$response$award\n        NSFtoUI <- bind_rows(NSFtoUI, as_tibble(awards_data))\n\n        # Debug: Print the current page number and number of awards fetched\n        print(paste(\"Page:\", current_page, \"- Awards fetched:\", length(awards_data$id)))\n\n        # Check if the current page has less than results_per_page awards, then it's the last page\n        if (length(awards_data$id) < results_per_page) {\n            keep_going <- FALSE\n        } else {\n            current_page <- current_page + 1\n        }\n    } else {\n        print(paste(\"Failed to fetch data: Status code\", status_code(response)))\n        keep_going <- FALSE\n    }\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Page: 1 - Awards fetched: 25\"\n[1] \"Page: 2 - Awards fetched: 25\"\n[1] \"Page: 3 - Awards fetched: 25\"\n[1] \"Page: 4 - Awards fetched: 25\"\n[1] \"Page: 5 - Awards fetched: 25\"\n[1] \"Page: 6 - Awards fetched: 25\"\n[1] \"Page: 7 - Awards fetched: 25\"\n[1] \"Page: 8 - Awards fetched: 25\"\n[1] \"Page: 9 - Awards fetched: 25\"\n[1] \"Page: 10 - Awards fetched: 25\"\n[1] \"Page: 11 - Awards fetched: 25\"\n[1] \"Page: 12 - Awards fetched: 25\"\n[1] \"Page: 13 - Awards fetched: 25\"\n[1] \"Page: 14 - Awards fetched: 25\"\n[1] \"Page: 15 - Awards fetched: 25\"\n[1] \"Page: 16 - Awards fetched: 25\"\n[1] \"Page: 17 - Awards fetched: 25\"\n[1] \"Page: 18 - Awards fetched: 25\"\n[1] \"Page: 19 - Awards fetched: 25\"\n[1] \"Page: 20 - Awards fetched: 25\"\n[1] \"Page: 21 - Awards fetched: 25\"\n[1] \"Page: 22 - Awards fetched: 25\"\n[1] \"Page: 23 - Awards fetched: 25\"\n[1] \"Page: 24 - Awards fetched: 8\"\n```\n\n\n:::\n:::\n\n\n\n## QUESTION 1:\n\nProvide a visualization that shows our active awards from each sponsor.  I need to see their start date and end date, the amount of the award, and the name of the Principal Investigator.  I'm really interested in seeing how far into the future our current portfolio will exist.  Are there a bunch of awards about to expire?  Are there a bunch that just got funded and will be active for a while?  Does this vary across sponsors?\n\n## QUESTION 2:\n\nWhat is the proportional representation of new awards to the UI from these various sources over the past 5 to 10 years?  Are there any trends that are encouraging or discouraging?\n\n## QUESTION 3: \n\nHow is UI performing with these sponsors when compared to the following peer institutions?\n\n1. Boise State University\n2. Idaho State University\n3. Montana State University\n4. University of Montana\n5. Washington State University\n\nNote that \"performing\" can mean a variety of different things.  You must choose your metrics of performance and justify them. \n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}